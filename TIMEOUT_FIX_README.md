# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ TimeoutException –≤ —Ç–µ—Å—Ç–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è Excel

## –ü—Ä–æ–±–ª–µ–º–∞
–¢–µ—Å—Ç `test_download_and_open_excel_file` –ø–∞–¥–∞–ª —Å –æ—à–∏–±–∫–æ–π `TimeoutException` –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –Ω–∞–π—Ç–∏ –∏–ª–∏ –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É `EXPORT_EXCEL_BUTTON`.

## –†–µ—à–µ–Ω–∏–µ

### 1. –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `download_excel_file`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–Ω–æ–ø–∫–∏ —Å 10 –¥–æ 15 —Å–µ–∫—É–Ω–¥
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —ç–ª–µ–º–µ–Ω—Ç—É –ø–µ—Ä–µ–¥ –∫–ª–∏–∫–æ–º
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –∫–ª–∏–∫–∞ —á–µ—Ä–µ–∑ JavaScript
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–∂–∏–¥–∞–Ω–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ (–¥–æ 30 —Å–µ–∫—É–Ω–¥)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–ö–æ–¥:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤–∏–¥–Ω–∞ –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞
export_button = self.element_in_clickable(self.EXPORT_EXCEL_BUTTON, timeout=15)

# –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
self.browser.execute_script("arguments[0].scrollIntoView({block: 'center'});", export_button)
sleep(1)

# –ö–ª–∏–∫–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É —ç–∫—Å–ø–æ—Ä—Ç–∞ Excel
export_button.click()
```

### 2. –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏

**–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `is_export_button_available()`:**
```python
def is_export_button_available(self):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ Excel"""
    try:
        self.element_in_visible(self.EXPORT_EXCEL_BUTTON, timeout=5)
        self.element_in_clickable(self.EXPORT_EXCEL_BUTTON, timeout=5)
        return True
    except:
        return False
```

### 3. –£–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

**–î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- ‚úÖ –ü–æ–∏—Å–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –ª–æ–∫–∞—Ç–æ—Ä–æ–≤ –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞

### 4. –ù–æ–≤—ã–π —É—Å—Ç–æ–π—á–∏–≤—ã–π —Ç–µ—Å—Ç

**–°–æ–∑–¥–∞–Ω `test_robust_excel_download()`:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ª–æ–∫–∞—Ç–æ—Ä—ã –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –í—ã–≤–æ–¥–∏—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –ò—â–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —ç–∫—Å–ø–æ—Ä—Ç–∞

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ó–∞–ø—É—Å–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
```bash
# –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç
pytest tests/test_contacts.py::TestContacts::test_download_and_open_excel_file -v -s

# –£—Å—Ç–æ–π—á–∏–≤—ã–π —Ç–µ—Å—Ç —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
pytest tests/test_contacts.py::TestContacts::test_robust_excel_download -v -s
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º:

1. **–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç `export_button_not_available.png`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HTML –≤ –∫–æ–Ω—Å–æ–ª–∏

2. **–ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç `download_error.png`
   - –£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç –≤ `max_wait_time`

3. **–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –∫–ª–∏–∫–∞–µ—Ç—Å—è:**
   - –ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø—Ä–æ–±—É–µ—Ç JavaScript –∫–ª–∏–∫
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç –¥—Ä—É–≥–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤

–ï—Å–ª–∏ —Ç–µ—Å—Ç –≤—Å–µ –µ—â–µ –ø–∞–¥–∞–µ—Ç, –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã:

```python
# –í download_excel_file
export_button = self.element_in_clickable(self.EXPORT_EXCEL_BUTTON, timeout=30)  # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 30 —Å–µ–∫

# –í –æ–∂–∏–¥–∞–Ω–∏–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
max_wait_time = 60  # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 60 —Å–µ–∫—É–Ω–¥
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ—Å—Ç —Ç–µ–ø–µ—Ä—å –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
- ‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ª–æ–∫–∞—Ç–æ—Ä—ã –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
- ‚úÖ –í—Ä–µ–º—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
- ‚úÖ –†–∞–∑–º–µ—Ä –∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
- ‚ùå –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ç–µ—Å—Ç —Å—Ç–∞–ª:
- üöÄ –ë–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤—ã–º –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø—Ä–æ–±–ª–µ–º–∞–º
- üîç –ë–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚è±Ô∏è –ë–æ–ª–µ–µ –≥–∏–±–∫–∏–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ç–∞–π–º–∞—É—Ç–æ–≤
- üõ†Ô∏è –ë–æ–ª–µ–µ —É–¥–æ–±–Ω—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
