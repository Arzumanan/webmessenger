# Тест скачивания и открытия Excel файла

Этот проект содержит тесты для скачивания и открытия Excel файла с контактами используя локатор `EXPORT_EXCEL_BUTTON`.

## Установка зависимостей

Перед запуском тестов установите необходимые зависимости:

```bash
pip install -r requirements.txt
```

## Структура тестов

### 1. Основные тесты в `tests/test_contacts.py`

- `test_download_and_open_excel_file()` - Полный тест скачивания и открытия Excel файла
- `test_complete_excel_export()` - Комплексный тест экспорта с проверками

### 2. Пример отдельного теста `test_excel_download_example.py`

Простой пример для быстрого тестирования функциональности.

## Использование

### Запуск основных тестов

```bash
# Запуск всех тестов контактов
pytest tests/test_contacts.py -v

# Запуск только теста скачивания Excel
pytest tests/test_contacts.py::TestContacts::test_download_and_open_excel_file -v

# Запуск с Allure отчетом
pytest tests/test_contacts.py --alluredir=allure-results
allure serve allure-results
```

### Запуск примера

```bash
python test_excel_download_example.py
```

## Функциональность

### Методы в ContactsPage

1. **`download_excel_file(download_dir=None)`**
   - Скачивает Excel файл с контактами
   - Настраивает браузер для загрузки файлов
   - Проверяет успешность скачивания
   - Возвращает путь к скачанному файлу

2. **`verify_excel_file_content(file_path, expected_columns=None)`**
   - Читает Excel файл с помощью pandas
   - Проверяет, что файл не пустой
   - Проверяет наличие ожидаемых колонок
   - Возвращает DataFrame с данными

3. **`open_excel_file(file_path)`**
   - Открывает Excel файл в системе
   - Поддерживает Windows, macOS и Linux
   - Возвращает True/False в зависимости от успеха

4. **`test_excel_export_complete(download_dir=None, expected_columns=None)`**
   - Комплексный метод, объединяющий все функции
   - Скачивает, проверяет и открывает файл
   - Возвращает путь к файлу и DataFrame

## Настройка

### Ожидаемые колонки

В тестах настройте ожидаемые колонки под вашу структуру данных:

```python
expected_columns = ['Имя', 'Логин', 'Телефон', 'Канал']
```

### Папка для загрузок

По умолчанию файлы скачиваются в папку `downloads/` в корне проекта. Можно изменить:

```python
download_dir = "/path/to/your/downloads"
```

## Проверки

Тесты выполняют следующие проверки:

1. ✅ Файл успешно скачан
2. ✅ Файл существует и не пустой
3. ✅ Excel файл можно прочитать
4. ✅ Файл содержит данные
5. ✅ Присутствуют ожидаемые колонки
6. ✅ Файл можно открыть в системе

## Логирование

Тесты выводят подробную информацию:

- Путь к скачанному файлу
- Размер файла
- Количество строк и колонок
- Список колонок
- Первые строки данных

## Обработка ошибок

Тесты включают обработку ошибок:

- Проверка существования файла
- Проверка размера файла
- Обработка ошибок чтения Excel
- Обработка ошибок открытия файла

## Требования

- Python 3.7+
- Selenium 4.29.0
- pandas 2.0.3
- openpyxl 3.1.2
- Chrome WebDriver

## Примечания

- Убедитесь, что Chrome WebDriver установлен и доступен в PATH
- Настройте `expected_columns` под структуру ваших данных
- При необходимости измените локатор `EXPORT_EXCEL_BUTTON` в `contacts_page.py`
